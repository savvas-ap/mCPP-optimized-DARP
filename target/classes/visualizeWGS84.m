clear;
clc;
close all;



%% Polygon ROI - coverage paths - coverage distance

polygonWGS84 = [40.873884282708275, 24.312673846131773;
40.873728114416515, 24.31273330177858;
40.87360034008555, 24.3129215034581;
40.873545579582554, 24.313190171408067;
40.873555720419844, 24.313501754702273;
40.87359222742132, 24.313648158617823;
40.873661185035814, 24.313783833697315;
40.873758536839944, 24.313891904372284;
40.87386400113278, 24.313978517375133;
40.87399785941641, 24.31410804572222;
40.8740647884567, 24.314237182912123;
40.87409622480081, 24.314341984642297;
40.87411143592965, 24.31448970171671;
40.8739248458407, 24.316089192386542;
40.875318779965916, 24.316346684451972;
40.87574062618736, 24.312577286607237;
40.87517412533149, 24.312598744279356;
40.8749767391839, 24.312829414254637;
40.87408775656638, 24.312657752877683];

obstacles = {[40.87435937003009, 24.313325920763702;
40.87430866644355, 24.31344781227139;
40.87428230056317, 24.313612619123276;
40.874245793942215, 24.31376267382558;
40.87410787985927, 24.314191678265473;
40.87490857822834, 24.31438747952356;
40.87499375945969, 24.31393180199605;
40.874996167856025, 24.3138444811903;
40.874974238770626, 24.313762524802627;
40.87495332374008, 24.313698002773506;
40.87492023995101, 24.31362006969931;
40.87490071924024, 24.31354601092592;
40.87489742353518, 24.313482680988585;
40.87491516963704, 24.313404300876144;
40.87494102823421, 24.313331285181732;
40.874623834026536, 24.31324813670227;
40.874463208213406, 24.31324411338875]};
            
path = [40.87511606353929, 24.31620760355072;
40.8752938771259, 24.31624525463758;
40.875722508208646, 24.312731338258402;
40.87518906400966, 24.31261841297073;
40.875131919836605, 24.313086934114185;
40.87370940222757, 24.312785799110443;
40.87362368419745, 24.31348856472302;
40.87380149874874, 24.31352620772088;
40.873858644728095, 24.313057696296713;
40.874036459407904, 24.313095338278785;
40.873922165245325, 24.314032362757327;
40.87409997960375, 24.31407000737295;
40.87421427406625, 24.313132980461504;
40.875103347036074, 24.313321194384923;
40.874960475893324, 24.31449249272835;
40.87424921906012, 24.31434190902361;
40.87404918156848, 24.315981701244166;
40.87422699528397, 24.31601935112686;
40.87439845786906, 24.31461381189068;
40.87457627201311, 24.314651458324757;
40.874404808977985, 24.316057001210247;
40.87458262265053, 24.31609465149432;
40.87475408613569, 24.31468910495951;
40.87493190023679, 24.314726751794936;
40.8747604363016, 24.31613230197909;
40.87493824993119, 24.31616995266456;
40.875338306840646, 24.312890315812947;
40.87551612149866, 24.312927958183753;
40.87511606353929, 24.31620760355072];



%% Transform to NED
% Transformation for polygon
[n,m] = size(polygonWGS84);
polygonNED = zeros(n,m);
wgs84 = wgs84Ellipsoid;
fprintf(' ~~~ Polygon hull: ~~~ \n\n');
for i=1:n
    [polygonNED(i,1), polygonNED(i,2)] = geodetic2ned(polygonWGS84(i,1),polygonWGS84(i,2),0,polygonWGS84(1,1),polygonWGS84(1,2),0,wgs84);
    fprintf('- {x: %f, y: %f, z: %f}\n', polygonNED(i,2), polygonNED(i,1), 4.0);
end

% Transformation for obstacles
if (~isempty(obstacles))
    fprintf('\n\n ~~~ Obstacles: ~~~ \n');
    for i = 1:length(obstacles)
        fprintf('\n - NFZ %d: \n',i);
        [o1,o2] = size(obstacles{i});
        obNED = zeros(o1,o2);
        for j=1:o1
            [obNED(j,1), obNED(j,2)] = geodetic2ned(obstacles{i}(j,1),obstacles{i}(j,2),0,polygonWGS84(1,1),polygonWGS84(1,2),0,wgs84);
            fprintf('- {x: %f, y: %f, z: %f}\n', obNED(j,2), obNED(j,1), 4.0);
        end
        obstNED{i} =  obNED;
    end
end

% Transformation for path
[k,l] = size(path);
pathNED = zeros(k,l);
for i=1:k
    [pathNED(i,1), pathNED(i,2)] = geodetic2ned(path(i,1),path(i,2),0,polygonWGS84(1,1),polygonWGS84(1,2),0,wgs84);
end

%% Plot paths in poly
figure;

hold on;

title('Polygon ROI with paths')
axis equal;
axis off;

fill(polygonNED(:,2),polygonNED(:,1),'g');      % polygon

if (~isempty(obstacles))                        % obstacles
    for i=1:length(obstacles)
        fill(obstNED{i}(:,2), obstNED{i}(:,1),'r')
    end
end

plot(pathNED(:,2),pathNED(:,1),'k --');         % paths

hold off;
